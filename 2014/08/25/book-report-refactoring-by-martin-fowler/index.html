<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Book Report: Refactoring by Martin Fowler | Yusuke Tsutsumi</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Book Report: Refactoring by Martin Fowler" />
<meta name="author" content="toumorokoshi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Refactoring is a book covering the basics tenants of refactoring as dictated by Martin Fowler: a very smart person with some very good ideas about code in general." />
<meta property="og:description" content="Refactoring is a book covering the basics tenants of refactoring as dictated by Martin Fowler: a very smart person with some very good ideas about code in general." />
<link rel="canonical" href="https://y.tsutsumi.io/2014/08/25/book-report-refactoring-by-martin-fowler/" />
<meta property="og:url" content="https://y.tsutsumi.io/2014/08/25/book-report-refactoring-by-martin-fowler/" />
<meta property="og:site_name" content="Yusuke Tsutsumi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Book Report: Refactoring by Martin Fowler" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"toumorokoshi"},"dateModified":"2014-08-25T00:00:00+00:00","datePublished":"2014-08-25T00:00:00+00:00","description":"Refactoring is a book covering the basics tenants of refactoring as dictated by Martin Fowler: a very smart person with some very good ideas about code in general.","headline":"Book Report: Refactoring by Martin Fowler","mainEntityOfPage":{"@type":"WebPage","@id":"https://y.tsutsumi.io/2014/08/25/book-report-refactoring-by-martin-fowler/"},"url":"https://y.tsutsumi.io/2014/08/25/book-report-refactoring-by-martin-fowler/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://y.tsutsumi.io/feed/index.xml" title="Yusuke Tsutsumi" />
</head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Yusuke Tsutsumi</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <a class="page-link" href="/tag/coding/">Coding Posts</a>
                <a class="page-link"
                    href="https://nbviewer.jupyter.org/github/toumorokoshi/notebooks/tree/master/">Notebooks</a><a class="page-link" href="/resources/">Resources</a><a class="page-link" href="/about/">About Yusuke Tsutsumi</a></div>
        </nav></div>
    <style>
        .gse-control-cse td {
            border: 0;
        }

        td.gsc-input {
            border: 0;
        }

        td.gsc-search-button {
            border: 0;
        }

        table.gsc-input {
            margin-bottom: 0;
        }
    </style>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">Book Report: Refactoring by Martin Fowler</h1>
        <p class="post-meta"><time class="dt-published" datetime="2014-08-25T00:00:00+00:00" itemprop="datePublished">
                Aug 25, 2014
            </time>â€¢ 
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span class="p-author h-card" itemprop="name">toumorokoshi</span></span></p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
        <p>Refactoring is a book covering the basics tenants of refactoring as
dictated by Martin Fowler: a very smart person with some very good ideas
about code in general.</p>

<p>First, the interesting thing about the definition of refactoring (as
defined by this book) is that it doesn't encompass all code cleanup. It
explicitly defines refactoring as a disciplined practice that involves:</p>

<ul>
  <li>a rigorous test suite to ensure code behaves as desired beforehand.</li>
  <li>a set of steps that ensures that, at every step, the code works as
before.</li>
</ul>

<p>There's a lot of gems in this book. 'Refactoring' not only covers the
basic tenants around refactoring, but also provides a great set of
guidelines around writing code that is very easy for future maintainers
to understand as well.</p>
                <h2 id="the-indicators-for-refactoring">   The Indicators for Refactoring <a href="#the-indicators-for-refactoring">#</a>   </h2>
                    

<p>After showing a great example of a step-by-step refactoring of code that
excellently preserves functionality, the next chapter describes several
code smells that indicate the need for a refactor:</p>

<ul>
  <li>duplicate code: a common red flag for anyone familiar with the age
old adage DRY (Don't repeat yourself)</li>
  <li>long methods: definitely a good sign for a refactor. I can't recall
how many methods I've read where I've barely been able to keep
mental track of what's really going on here.</li>
  <li>strong coupling: Definitely not an easy one to catch when you're
hacking away hardcore at something. Sometimes it takes a real
objective look at your code to find that the two classes or methods
that you've been working with should really be one, or maybe
organized separately.</li>
</ul>

<p>Aside from this, the book explicitly describes several situations which
indicate the need to consider refactoring. That said (and Martin also
admits this), it's not even close to outlining every single situation
where refactoring is necessary. After all, programming, despite
requiring a very logical and objective mind, can be a very subjective
practice.</p>
                <h2 id="the-actual-refactorings">   The Actual Refactorings <a href="#the-actual-refactorings">#</a>   </h2>
                    

<p>After going over the smells, the next chapters finally describe the
actual refactoring themselves. The description of the refactoring
themselves is very rigorous, covering motivation, explicit steps and
examples. It's a very good reference to cover all of your bases, and
like any book that describes patterns, is a good reference to keep
somewhere when tackling particularly difficult refactoring tasks.</p>

<p>A lot of the refactors were ones I was already familiar with, but there
were some interesting cases I didn't really think a lot about, that
'Refactoring' helped me assess more deeply:</p>
                <h3 id="replace-temp-with-query">   Replace Temp with Query <a href="#replace-temp-with-query">#</a>   </h3>
                    

<p>The summary of this description is to replace temporary variables with a
method that generates the state desired:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">shift_left</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">digits</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">multiplier</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">shift_left</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">_power_of_two</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_power_of_two</span><span class="p">(</span><span class="n">digits</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">digits</span>
</code></pre></div></div>

<p>This is a trivial example, and not necessarily representative of a real
refactoring. However, using a 'query method' to generate state helps
prevent several bad patterns from emerging:</p>

<ul>
  <li>modifying the local variable to be different than the initial
intention</li>
  <li>ensure that the variable is not misused anywhere else</li>
</ul>

<p>It's a good example of a refactoring that help ensure the variable is
actually temporary, and is not misused.</p>
                <h3 id="introduce-explaining-variable">   Introduce Explaining Variable <a href="#introduce-explaining-variable">#</a>   </h3>
                    

<p>At the end of the day, good code is 90% about making it easier for
others to read. Code that works is great, but code that can not be
understood or maintained is not going to last when that code is
encountered a second time.</p>

<p>Explaining variables really help here. This is the idea of making
ambiguous code more clearer by assigning results to named variables that
express the intent a lot better:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">interest</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">amount</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.414</span> <span class="o">**</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">interest</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="n">e_constant</span> <span class="o">=</span> <span class="mf">1.414</span>
    <span class="k">return</span> <span class="n">amount</span> <span class="o">*</span> <span class="n">Ce_constant</span> <span class="o">**</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span>
</code></pre></div></div>

<p>Having very descriptive variables can make understanding the code a lot
easier.</p>
                <h3 id="remove-assignment-to-parameters">   Remove Assignment to Parameters <a href="#remove-assignment-to-parameters">#</a>   </h3>
                    

<p>This is saying basically avoid mutating input parameters:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<p>This is nice because it makes it easier to work with input parameters
later: mutating values that have clear intent can result to poor misuse
of those variables later (because you assume no one changed it, or it
actually describes the value it should). This could be inefficient, but
compiler optimizers can get rid of these inefficiencies anyway, so why
make it more confusing to a potential consumer?</p>
                <h3 id="duplicate-observed-data">   Duplicate Observed Data <a href="#duplicate-observed-data">#</a>   </h3>
                    

<p>This is basically pushing for a decoupling of data stored on both a
client (interface) as well as a publisher. There's a lot of times where
the client will store data that's almost identical to an object that
already exists and has all the information stored neatly. Reducing the
duplication of data is always a good thing.</p>
                <h3 id="separate-query-from-modifier">   Separate Query from Modifier <a href="#separate-query-from-modifier">#</a>   </h3>
                    

<p>There's a lot of methods that not only perform formatting or retrieve
data, but also mutate data as well. This refactoring suggests separating
them:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
    <span class="n">log_object</span><span class="p">.</span><span class="n">access_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log_object</span><span class="p">.</span><span class="n">names</span><span class="p">]</span>
</code></pre></div></div>

<p>After:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">increment_access_count</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
  <span class="n">log_object</span><span class="p">.</span><span class="n">access_count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log_object</span><span class="p">.</span><span class="n">names</span><span class="p">]</span>

<span class="n">increment_access_count</span><span class="p">(</span><span class="n">log_object</span><span class="p">)</span>
<span class="k">return</span> <span class="n">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">)</span>
</code></pre></div></div>

<p>I can't count the number of times I wanted to have one specific part of
the function a function performs. Refactorings such as this one really
give modular pieces that can be stitched together as necessary.</p>
                <h2 id="the-general-refactoring-principles">   The General Refactoring Principles <a href="#the-general-refactoring-principles">#</a>   </h2>
                    

<p>The book's scatters some great gems about what a good refactoring looks
like, and it's very similar to what is commonly known to be good code:</p>

<ul>
  <li>mostly self-documenting: code that is so easily legible that it your
barely even need comments to understand what it's doing:
intelligible variable and function names, written like plain English
more that code.</li>
  <li>modular: each function is split into small, singularly functional
units.</li>
  <li>taking advantage of the principles and idioms for the language at
hand: 'refactoring' was written with object-oriented languages in
mind, so it advocated strong utilization of OOP. Utilize the
programming language's strengths.</li>
</ul>

<p>Any step that takes your code in that direction (whilst preserving
functionality) is a good example of a refactoring.</p>
                <h2 id="how-to-allocate-time-to-refactor">   How to Allocate Time to Refactor <a href="#how-to-allocate-time-to-refactor">#</a>   </h2>
                    

<p>'Refactoring' also stresses and appropriate time to refactor code:
constantly. Martin Fowler argues refactoring should occur during the
development process, and time should be added to estimates to give space
for refactoring. I've never been given explicit amounts of time to
refactor code, and most of the time, you won't. Best thing to do is to
push yourself to refactor whenever it's appropriate. The book also
warns against going overboard, only refactoring what you need. It's a
very agile approach to the idea of refactoring.</p>
                <h2 id="conclusion">   Conclusion <a href="#conclusion">#</a>   </h2>
                    

<p>Ultimately, 'Refactoring' doesn't blow my mind and introduce me to
some life-changing concept. That said, it definitely changed my mindset
about refactoring. Refactoring should:</p>

<ul>
  <li>be done as you go</li>
  <li>move the code toward being easily comprehensible</li>
  <li>move the code toward being easily extendable</li>
  <li>have a strong set of testing around it to preserve functionality</li>
</ul>

<p>As I was about to tackle a fairly large refactoring, It was a great read
to organize my thoughts about my methodologies and practices, and my
goals.</p>

<p>I don't recommend reading every word, but the chapters that explain
philosophies and glancing over the refactoring patters was more that
worth the time spent reading.</p>
    </div><a class="u-url" href="/2014/08/25/book-report-refactoring-by-martin-fowler/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/%20/"></data>

    <div class="wrapper">

        <div class="footer-col-wrapper">
            <script async src="https://cse.google.com/cse.js?cx=014358564571565173111:hnnbq4j54cy"></script>
            <div class="gcse-search"></div>
        </div>
        <div class="footer-col-wrapper">
            <div class="footer-col">
                <p class="feed-subscribe">
                    <a href="/feed/index.xml">
                        <svg class="svg-icon orange">
                            <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
                        </svg><span>Subscribe</span>
                    </a>
                </p>
            </div>
            <div class="footer-col">
                <p>My blog on software, productivity, and obsessively optimizing. I work at Google, ex-Zillow. Thoughts my own.</p>
            </div>
        </div>

        <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/toumorokoshi" target="_blank" title="toumorokoshi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/yusuke-tsutsumi" target="_blank" title="yusuke-tsutsumi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/tsutsumiyusuke" target="_blank" title="tsutsumiyusuke"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

    </div>

</footer></body>

</html>
