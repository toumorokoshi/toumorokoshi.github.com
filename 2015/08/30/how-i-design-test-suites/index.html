<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How I Design Test Suites | Yusuke Tsutsumi</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="How I Design Test Suites" />
<meta name="author" content="toumorokoshi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="At Zillow, I&#39;ve done a lot of work on the design and development of the test infrastructure we use for full-stack tests. It&#39;s always fun to watch your tool become popular, but even more interesting is the discussions around test suite design that come with it." />
<meta property="og:description" content="At Zillow, I&#39;ve done a lot of work on the design and development of the test infrastructure we use for full-stack tests. It&#39;s always fun to watch your tool become popular, but even more interesting is the discussions around test suite design that come with it." />
<link rel="canonical" href="https://y.tsutsumi.io/2015/08/30/how-i-design-test-suites/" />
<meta property="og:url" content="https://y.tsutsumi.io/2015/08/30/how-i-design-test-suites/" />
<meta property="og:site_name" content="Yusuke Tsutsumi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-08-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How I Design Test Suites" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"toumorokoshi"},"dateModified":"2015-08-30T00:00:00+00:00","datePublished":"2015-08-30T00:00:00+00:00","description":"At Zillow, I&#39;ve done a lot of work on the design and development of the test infrastructure we use for full-stack tests. It&#39;s always fun to watch your tool become popular, but even more interesting is the discussions around test suite design that come with it.","headline":"How I Design Test Suites","mainEntityOfPage":{"@type":"WebPage","@id":"https://y.tsutsumi.io/2015/08/30/how-i-design-test-suites/"},"url":"https://y.tsutsumi.io/2015/08/30/how-i-design-test-suites/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://y.tsutsumi.io/feed/index.xml" title="Yusuke Tsutsumi" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-325KP61WS9"></script>
<script>
  window['ga-disable-G-325KP61WS9'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-325KP61WS9');
</script>

</head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Yusuke Tsutsumi</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <a class="page-link" href="/tag/coding/">Coding Posts</a>
                <a class="page-link"
                    href="https://nbviewer.jupyter.org/github/toumorokoshi/notebooks/tree/master/">Notebooks</a><a class="page-link" href="/resources/">Resources</a><a class="page-link" href="/about/">About Yusuke Tsutsumi</a></div>
        </nav></div>
    <style>
        .gse-control-cse td {
            border: 0;
        }

        td.gsc-input {
            border: 0;
        }

        td.gsc-search-button {
            border: 0;
        }

        table.gsc-input {
            margin-bottom: 0;
        }
    </style>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">How I Design Test Suites</h1>
        <p class="post-meta"><time class="dt-published" datetime="2015-08-30T00:00:00+00:00" itemprop="datePublished">
                Aug 30, 2015
            </time>â€¢ 
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span class="p-author h-card" itemprop="name">toumorokoshi</span></span></p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
        <p>At Zillow, I've done a lot of work on the design and development of the
test infrastructure we use for full-stack tests. It's always fun to
watch your tool become popular, but even more interesting is the
discussions around test suite design that come with it.</p>

<p>Many discussions later, I have a good idea of what I want in a test
suite. Here's what I think about:</p>
                <h2 id="tests-are-a-question-of-cost">   Tests are a question of cost <a href="#tests-are-a-question-of-cost">#</a>   </h2>
                    

<p>At the end of the day, tests have a cost. Each and every test has a
value / cost ratio. Things that increase the value of a test include:</p>

<ul>
  <li>consistency: given the same inputs, give the same results, every
time.</li>
  <li>speed: the faster the test is, the faster the feedback. The faster
the feedback, the faster one can take action, and the more often we
can execute the tests to get feedback.</li>
</ul>

<p>In contrast, the things that increase the cost of a test include:</p>

<ul>
  <li>maintenance time: maintenance takes time, and development time is
expensive. probably the biggest cost to consider.</li>
  <li>cpu / memory to execute the test: although arguably cheap in this
world of cloud providers, cpu and memory are real concerns, and
tests that use a lot of these resources are expensive.</li>
  <li>the time to execute the test: time is a huge cost, especially as the
technology world we live in demands for more changes, more quickly.
Depending on how fast you ship, tests that take too long will be
prohibitively expensive, and thus not used.</li>
</ul>

<p>When I look at the value of a test, I look at these factors. In
practice, I've found that the most important metric of them all is
maintenance time: test that have little to no maintenance survive
refactors, rewrites, and pretty much anything that could happen to code
besides deprecation.</p>

<p>On the other hand, the more the test requires maintenance, the more
likely it'll suffer one of two outcomes:</p>

<ul>
  <li>the test is thrown out because it takes too much time to maintain,
despite the value.</li>
  <li>the test is not given the time it needs, and continues to fall into
disarray until it is ignored.</li>
</ul>

<p>Basically: low maintenance tests last forever, high maintenance tests
probably won't.</p>
                <h2 id="designing-cheap-tests">   Designing cheap tests <a href="#designing-cheap-tests">#</a>   </h2>
                    

<p>So how do we make tests that require little to no maintenance? From what
I've observed, there are two types of maintenance:</p>

<p>-</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>functional maintenance, which modifies the test to reflect changes in the code itself

:   -   e.g. for a web page, the login form fields are modified
</code></pre></div></div>

<p>-</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>operational maintenance, which requires keeping a service dependency in a good state to test.

:   -   e.g. for an office application with cloud sync, keeping the
        cloud syncing service up.
</code></pre></div></div>

<p>Functional maintenance is unavoidable: as code changes, one must ensure
that any tests that validate that code are kept up to date. In addition,
for most tests, functional maintenance is relatively cheap in time:
except in the cases of extreme redesigns or refactorings, the changes
tend to be small in nature.</p>

<p>Operational maintenance costs can vary wildly, and it can become very
expensive. Tests that have multiple dependencies can become a game of
juggling an environment where all of those are functional. It becomes
even harder if there's a small team maintaining this environment:
executing the tests consistently requires a production-quality
environment, and that's more difficult the more services there are to
maintain.</p>

<p>However, unlike functional maintenance, operational maintenance, for the
most part, is avoidable. Taking advantage of heavy mocking, it's
possible to remove dependencies like databases and APIs. <a href="http://googletesting.blogspot.com/2012/10/hermetic-servers.html">Google Testing
Blog has a good article about
this</a>.</p>

<p>Summary: tests with fewer operational dependencies are cheaper to
maintain.</p>
                <h2 id="what-kind-of-test-distribution-the-testing-pyramid">   What kind of test distribution: the testing pyramid <a href="#what-kind-of-test-distribution-the-testing-pyramid">#</a>   </h2>
                    

<p>When testing software, there are multiple levels at which one could
author tests:</p>

<ul>
  <li>at the "unit" level, typically written in the same language and
validating a single function or behaviour</li>
  <li>at the integration level, typically written in the same language,
and validating the communication between your code and an external
application</li>
  <li>at the end-to-end level, not necessarily written in the same
language, and validating a complete workflow that a user would be
performing.</li>
</ul>

<p>Although all are important and should be included in a test suite, each
test is not created equally. Going back to the idea that tests with the
least maintenance will last the longest, we should be trying to have as
many of those as possible.</p>

<p>Unit tests are the cheapest. They:</p>

<ul>
  <li>have no dependencies (or else they would at least be considered an
integration test),</li>
  <li>run quickly (no waiting for network, or other delay from
communication)</li>
</ul>

<p>If we could capture all behaviour of our application with just unit
tests, that would be perfect. Unfortunately, many things can go wrong
when composing multiple pieces of these units together, so some level of
integration and end-to-end tests will be needed. But the larger tests
should be fewer in number, since they are harder to maintain.</p>

<p>A good model to visualize a good distribution is the "testing
pyramid", as explained by <a href="http://martinfowler.com/bliki/TestPyramid.html">Martin
Fowler</a> and
<a href="http://googletesting.blogspot.com/2015/04/just-say-no-to-more-end-to-end-tests.html">Google</a>:</p>

<p><img src="testingpyramid.png" alt="image" /></p>

<p>The more expensive tests are fewer in number, while the cheaper tests
are much more common.</p>
                <h2 id="how-many-tests-should-be-in-a-suite">   How many tests should be in a suite <a href="#how-many-tests-should-be-in-a-suite">#</a>   </h2>
                    

<p>Adequate test coverage varies wildly between applications: medical
software than monitors heart rate should probably have a lot more
coverage than a non-critical social media website. The only common rule
of thumb I've found is: add the absolute minimum number of tests to
achieve your desired confidence in quality.</p>

<p>Testing is important, but at the end of the day, it's not a user-facing
feature. On the other hand, quality is. Adding additional tests does
increase quality, but it comes at the cost of development and
maintenance time toward other features that help your application
provide value. A properly sized testing suite comes right at the line of
too little testing, and hover around that. This gives developers as much
time as possible on features, while ensuring that an important feature
(quality) is not neglected.</p>
                <h2 id="summary">   Summary <a href="#summary">#</a>   </h2>
                    

<ul>
  <li>the best tests are the cheapest tests: low maintenance and executes
quickly and low CPU/RAM resources</li>
  <li>the cheapest tests have the fewest number of dependencies on other
applications, like DBs or APIs</li>
  <li>try to keep test coverage as low level as possible, and cheap tests
are worth 10x expensive ones.</li>
  <li>expensive tests validate the whole infrastructune, so they're
almost always necessary: refer to the test pyramid for a rough
sketch of a good distribution.</li>
  <li>never add more or less coverage than you need: more coverage results
in more maintenance that detracts from development time, and less
coverage means an application whose quality is not up to the desired
standards.</li>
  <li>how much coverage do I need? Depends on how critical the application
is, and how critical it continues to work. A payment path needs high
quality, so should have high coverage. The alignment of a button on
a dialog three pages deep probably needs less quality assurance.</li>
</ul>

<p>How do you design your test suite?</p>
    </div><a class="u-url" href="/2015/08/30/how-i-design-test-suites/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/%20/"></data>

    <div class="wrapper">

        <div class="footer-col-wrapper">
            <script async src="https://cse.google.com/cse.js?cx=014358564571565173111:hnnbq4j54cy"></script>
            <div class="gcse-search"></div>
        </div>
        <div class="footer-col-wrapper">
            <div class="footer-col">
                <p class="feed-subscribe">
                    <a href="/feed/index.xml">
                        <svg class="svg-icon orange">
                            <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
                        </svg><span>Subscribe</span>
                    </a>
                </p>
            </div>
            <div class="footer-col">
                <p>My blog on software, productivity, and obsessively optimizing. I work at Google, ex-Zillow. Thoughts my own.</p>
            </div>
        </div>

        <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/toumorokoshi" target="_blank" title="toumorokoshi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/yusuke-tsutsumi" target="_blank" title="yusuke-tsutsumi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/tsutsumiyusuke" target="_blank" title="tsutsumiyusuke"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

    </div>

</footer></body>

</html>
