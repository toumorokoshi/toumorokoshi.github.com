<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AEPCLI’s design decisions | Yusuke Tsutsumi</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="AEPCLI’s design decisions" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="aepcli’s design decisions" />
<meta property="og:description" content="aepcli’s design decisions" />
<link rel="canonical" href="https://y.tsutsumi.io/aepcli-design/" />
<meta property="og:url" content="https://y.tsutsumi.io/aepcli-design/" />
<meta property="og:site_name" content="Yusuke Tsutsumi" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-22T07:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AEPCLI’s design decisions" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-10-22T07:00:00+00:00","datePublished":"2024-10-22T07:00:00+00:00","description":"aepcli’s design decisions","headline":"AEPCLI’s design decisions","mainEntityOfPage":{"@type":"WebPage","@id":"https://y.tsutsumi.io/aepcli-design/"},"url":"https://y.tsutsumi.io/aepcli-design/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://y.tsutsumi.io/feed/index.xml" title="Yusuke Tsutsumi" /><script async src="https://www.googletagmanager.com/gtag/js?id=G-325KP61WS9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { window.dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-325KP61WS9');
</script>
</head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Yusuke Tsutsumi</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger">
                <a class="page-link" href="/tag/coding/">Coding Posts</a>
                <a class="page-link"
                    href="https://nbviewer.jupyter.org/github/toumorokoshi/notebooks/tree/master/">Notebooks</a><a class="page-link" href="/resources/">Resources</a><a class="page-link" href="/about/">About Yusuke Tsutsumi</a></div>
        </nav></div>
    <style>
        .gse-control-cse td {
            border: 0;
        }

        td.gsc-input {
            border: 0;
        }

        td.gsc-search-button {
            border: 0;
        }

        table.gsc-input {
            margin-bottom: 0;
        }
    </style>
</header><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <h1 class="post-title p-name" itemprop="name headline">AEPCLI&#39;s design decisions</h1>
        <p class="post-meta"><time class="dt-published" datetime="2024-10-22T07:00:00+00:00" itemprop="datePublished">
                Oct 22, 2024
            </time></p>
    </header>

    <div class="post-content e-content" itemprop="articleBody">
        <h1 id="aepclis-design-decisions">   aepcli’s design decisions <a href="#aepclis-design-decisions">#</a>   </h1>
                    
                <h2 id="background">   Background <a href="#background">#</a>   </h2>
                    

<p>In my spare time, I work on <a href="https://aep.dev/">aep.dev</a>, an resource-oriented
API design specification. We’ve done a lot of work around standarization, like
<a href="https://aep.dev/121/">updating guidance on resource-oriented design</a>, fleshing
out standard
<a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUDL</a> methods, and design patterns.</p>

<p>I wanted to really prove out that those patterns and consistency could be used
to create powerful clients, so I’ve been working on
<a href="https://github.com/aep-dev/aepcli">aepcli</a>: a command-line interface to APIs
that can consume AEP-compliant HTTP+JSON APIs.</p>

<p>I’ve had some design musings as I’ve been writing it, and I wanted to expand on
some here.</p>
                <h2 id="installing-aepcli">   Installing aepcli <a href="#installing-aepcli">#</a>   </h2>
                    

<p>If you’d like to follow along (<em>warning</em>: it is a very early alpha as of
2024-10-19), you can install aepcli yourself.</p>

<p>See <a href="https://github.com/aep-dev/aepcli">the readme</a> for the latest instructions,
but as of the moment the installation method is a <code class="language-plaintext highlighter-rouge">go install</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>go <span class="nb">install </span>github.com/aep-dev/aepcli/cmd/aepcli@latest
</code></pre></div></div>
                <h2 id="overall-design">   Overall design <a href="#overall-design">#</a>   </h2>
                    

<p>aepcli is heavily inspired by
<a href="https://kubernetes.io/docs/reference/kubectl/">kubectl</a> - itself a command-line
interface that is able to interact with a heterogenous collection of resources (those exposed by the Kubernetes API server). It has been a great reference when designing aepcli.</p>
                <h2 id="consuming-an-openapi-definition">   Consuming an OpenAPI definition <a href="#consuming-an-openapi-definition">#</a>   </h2>
                    

<p>aepcli does not need to re-invent the wheel and use new API document syntax -
<a href="https://spec.openapis.org/oas/latest.html">The OpenAPI Specification</a> is
descriptive enough (with the appropriate
<a href="https://aep.dev/4/#annotating-resource-types">extensions</a>) to describe the
resources and operations supported.</p>

<p>This is also similar to how kubectl works - reading and caching an OpenAPI
definition exposed by the Kubernetes api server. For aepcli, the location of the
definition is required, so the path is first positional argument, no matter the
command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aepcli https://bookstore.example.com/openapi.json publishers list
</code></pre></div></div>

<p>The first argument accepts either a URL, or a local file path: this is helpful
in the situation where the API itself does not expose an OpenAPI definition, and
you need to write one yourself. Or better yet, generate one with
<a href="https://github.com/aep-dev/aepc">aepc</a>!</p>
                <h2 id="adding-a-config-file">   Adding a config file <a href="#adding-a-config-file">#</a>   </h2>
                    

<p>It’s a little cumbersome to add configuration for aepcli every time. In
addition, it doesn’t look particularly elegant to include a URL/filename on
every invocation.</p>

<p>Kubectl has the concept of a <a href="https://kubernetes.io/docs/reference/kubectl/quick-reference/#kubectl-context-and-configuration">context</a>, which helps configure it to the appropriate API server. This allows kubectl to have a one-to-many relationship, being able to operate on multiple different api servers.</p>

<p>So what if we could do that with aepcli? aepcli supports a config file, located at <code class="language-plaintext highlighter-rouge">$HOME/.config/aepcli/config.toml</code> for Linux. You can write something like this:</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[apis.roblox]</span>
<span class="py">openapipath</span> <span class="p">=</span> <span class="s">"openapi/roblox.json"</span> <span class="c"># relative paths are taken from the `$HOME/.config/aepcli` directory.</span>
<span class="py">headers</span> <span class="p">=</span> <span class="p">[</span>
    <span class="py">"x-api-key</span><span class="p">=</span><span class="err">${ROBLOX_API_KEY}</span><span class="s">" # add your api key here.</span><span class="err">
</span><span class="p">]</span>
</code></pre></div></div>

<p>And aepcli will let you easily refer to that API by it’s name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aepcli roblox <span class="nb">users </span>get <span class="k">${</span><span class="nv">USER_ID</span><span class="k">}</span>
<span class="o">{</span>
  <span class="s2">"path"</span>: <span class="s2">"users/</span><span class="k">${</span><span class="nv">USER_ID</span><span class="k">}</span><span class="s2">"</span>,
  <span class="s2">"name"</span>: <span class="s2">"NAME"</span>,
  <span class="s2">"about"</span>: <span class="s2">""</span>,
  <span class="s2">"locale"</span>: <span class="s2">"en_us"</span>,
  <span class="s2">"premium"</span>: <span class="nb">false</span>,
  <span class="s2">"idVerified"</span>: <span class="nb">false</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This makes support of a new API very easy - just write the appropriate entry in
your config, and you’re done!</p>

<p>This one-to-many CLI opens new use cases that other, bespoke CLIs cannot - like
using two APIs together. If you need a user id from an authentication provider,
and want to use that to do a lookup in some other service, you can do something
like:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">USERNAME</span><span class="o">=</span><span class="si">$(</span>aepcli auth-service get <span class="nb">users </span>foo | jq .username<span class="si">)</span>
aepcli docs-service list documents <span class="nt">--user</span><span class="o">=</span><span class="k">${</span><span class="nv">USERNAME</span><span class="k">}</span>
</code></pre></div></div>
                <h2 id="client-side-dynamicism-over-code-generation">   client-side dynamicism over code generation <a href="#client-side-dynamicism-over-code-generation">#</a>   </h2>
                    

<p>This point is more nuanced - but aepcli explicity chose to generate the CLI
based on an API description schema, instead of opting toward a code-generated
client.</p>

<p>From my time working at cloud companies, a common issue customers encountered
was with upgrading clients. Whether it was a command-line interface, Terraform
provider or SDK, customers would often have to go through painful upgrades to
use new fields exposed in the resources, since those clients were code-generated or hand-written and
only knew about the fields that the API exposed at the time it was authored.</p>

<p>There are multiple reasons why, in a worst case scenario, these upgrades would take months:</p>

<ul>
  <li>Security review.</li>
  <li>Other executive approvals.</li>
  <li>Waiting for a centralized platform team to perform the update, who often have
limited bandwidth due to serving requests across the whole company.</li>
  <li>A change in the client for a separate resource being backwards-incompatible,
requiring updating usages of that other resource to upgrade.</li>
</ul>

<p>These delays are harmful to both sides: inaccessible features for the consumer
and lost revenue for the service provider.</p>

<p>aepcli is fully dynamic - to use a new field, you don’t need to update any
<em>binaries</em> - you just update the OpenAPI document, which is completely in the
control of the consumer. Do you want access to a new field? Just add it to your
local copy of the OpenAPI document.</p>
                <h2 id="conclusion">   Conclusion <a href="#conclusion">#</a>   </h2>
                    

<p>Although these are some of the big design considerations, there’s dozens of
smaller ones that I’m sure I’ll hash over at some point. If you have ideas or suggestions, please share them! File an issue over at <a href="https://github.com/aep-dev/aepcli/issues">aepcli</a>, or <a href="/about#contact">reach out to me</a>!</p>
    </div><a href="#0" onclick="loadDisqus()">click to load comments via Disqus (ad supported and will cause tracking to load.
    requires javascript).</a>
<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'https://y.tsutsumi.io/aepcli-design/';
        this.page.identifier = '/aepcli-design/';
    };

    function loadDisqus() {
        var d = document, s = d.createElement('script');

        s.src = 'https://tsutsumi.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    }
</script>
<noscript>no comments avaialable with Javascript disabled.</noscript><a class="u-url" href="/aepcli-design/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/%20/"></data>

    <div class="wrapper">

        <div class="footer-col-wrapper">
            <script async src="https://cse.google.com/cse.js?cx=014358564571565173111:hnnbq4j54cy"></script>
            <div class="gcse-search"></div>
        </div>
        <div class="footer-col-wrapper">
            <div class="footer-col">
                <p class="feed-subscribe">
                    <a href="/feed/index.xml">
                        <svg class="svg-icon orange">
                            <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
                        </svg><span>Subscribe</span>
                    </a>
                </p>
            </div>
            <div class="footer-col">
                <p>My blog on software, productivity, and obsessively optimizing. I work at Google, ex-Zillow. Thoughts my own.</p>
            </div>
        </div>

        <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/toumorokoshi" target="_blank" title="toumorokoshi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/yusuke-tsutsumi" target="_blank" title="yusuke-tsutsumi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/tsutsumiyusuke" target="_blank" title="tsutsumiyusuke"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

    </div>

</footer></body>

</html>
