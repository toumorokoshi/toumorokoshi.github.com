<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>y.tsutsumi.io - refactoring</title>
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link href="http://y.tsutsumi.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="y.tsutsumi.io Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">y.tsutsumi.io </a></h1>
                <nav><ul>
                    <li><a href="/category/programming.html">Just Programming Posts</a></li>
                    <li><a href="/codersguide/">Coder's Guide</a></li>
                    <li><a href="https://nbviewer.jupyter.org/github/toumorokoshi/notebooks/tree/master/">Notebooks</a></li>
                    <li><a href="./pages/about-me.html">About Me</a></li>
                    <li><a href="./pages/projects.html">Projects</a></li>
                    <li><a href="./pages/resources.html">Resources</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="./book-report-refactoring-by-martin-fowler.html">Book Report: Refactoring by Martin Fowler</a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-08-25T00:00:00+02:00">
                Published: Mon 25 August 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="./author/yusuke-tsutsumi.html">Yusuke Tsutsumi</a>
        </address>
<p>In <a href="./category/programming.html">programming</a>.</p>
<p>tags: <a href="./tag/refactoring.html">refactoring</a> </p>
</footer><!-- /.post-info --><p>Refactoring is a book covering the basics tenants of refactoring as
dictated by Martin Fowler: a very smart person with some very good
ideas about code in general.</p>
<p>First, the interesting thing about the definition of refactoring (as
defined by this book) is that it doesn't encompass all code
cleanup. It explicitly defines refactoring as a disciplined practice
that involves:</p>
<ul class="simple">
<li>a rigorous test suite to ensure code behaves as desired beforehand.</li>
<li>a set of steps that ensures that, at every step, the code works as before.</li>
</ul>
<p>There's a lot of gems in this book. 'Refactoring' not only covers the
basic tenants around refactoring, but also provides a great set of
guidelines around writing code that is very easy for future
maintainers to understand as well.</p>
<div class="section" id="the-indicators-for-refactoring">
<h2>The Indicators for Refactoring</h2>
<p>After showing a great example of a step-by-step refactoring of code
that excellently preserves functionality, the next chapter describes
several code smells that indicate the need for a refactor:</p>
<ul class="simple">
<li>duplicate code: a common red flag for anyone familiar with the age
old adage DRY (Don't repeat yourself)</li>
<li>long methods: definitely a good sign for a refactor. I can't recall
how many methods I've read where I've barely been able to keep mental track
of what's really going on here.</li>
<li>strong coupling: Definitely not an easy one to catch when you're
hacking away hardcore at something. Sometimes it takes a real objective look at
your code to find that the two classes or methods that you've been working with
should really be one, or maybe organized separately.</li>
</ul>
<p>Aside from this, the book explicitly describes several situations
which indicate the need to consider refactoring. That said (and Martin
also admits this), it's not even close to outlining every single
situation where refactoring is necessary. After all, programming,
despite requiring a very logical and objective mind, can be a very
subjective practice.</p>
</div>
<div class="section" id="the-actual-refactorings">
<h2>The Actual Refactorings</h2>
<p>After going over the smells, the next chapters finally describe the
actual refactoring themselves. The description of the refactoring
themselves is very rigorous, covering motivation, explicit steps and
examples. It's a very good reference to cover all of your bases, and
like any book that describes patterns, is a good reference to keep
somewhere when tackling particularly difficult refactoring tasks.</p>
<p>A lot of the refactors were ones I was already familiar with, but
there were some interesting cases I didn't really think a lot about, that
'Refactoring' helped me assess more deeply:</p>
<div class="section" id="replace-temp-with-query">
<h3>Replace Temp with Query</h3>
<p>The summary of this description is to replace temporary variables with
a method that generates the state desired:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">shift_left</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">digits</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">multiplier</span>
</pre></div>
<p>After:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">shift_left</span><span class="p">(</span><span class="n">digits</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">*</span> <span class="n">_power_of_two</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_power_of_two</span><span class="p">(</span><span class="n">digits</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">digits</span>
</pre></div>
<p>This is a trivial example, and not necessarily representative of a
real refactoring. However, using a 'query method' to generate state
helps prevent several bad patterns from emerging:</p>
<ul class="simple">
<li>modifying the local variable to be different than the initial intention</li>
<li>ensure that the variable is not misused anywhere else</li>
</ul>
<p>It's a good example of a refactoring that help ensure the variable is
actually temporary, and is not misused.</p>
</div>
<div class="section" id="introduce-explaining-variable">
<h3>Introduce Explaining Variable</h3>
<p>At the end of the day, good code is 90% about making it easier for
others to read. Code that works is great, but code that can not be
understood or maintained is not going to last when that code is
encountered a second time.</p>
<p>Explaining variables really help here. This is the idea of making
ambiguous code more clearer by assigning results to named variables that
express the intent a lot better:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interest</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">amount</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.414</span> <span class="o">**</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span>
</pre></div>
<p>After:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">interest</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">percentage</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
    <span class="n">e_constant</span> <span class="o">=</span> <span class="mf">1.414</span>
    <span class="k">return</span> <span class="n">amount</span> <span class="o">*</span> <span class="n">Ce_constant</span> <span class="o">**</span> <span class="p">(</span><span class="n">percentage</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span>
</pre></div>
<p>Having very descriptive variables can make understanding the code a
lot easier.</p>
</div>
<div class="section" id="remove-assignment-to-parameters">
<h3>Remove Assignment to Parameters</h3>
<p>This is saying basically avoid mutating input parameters:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">*=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
<p>After:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
<p>This is nice because it makes it easier to work with input parameters
later: mutating values that have clear intent can result to poor
misuse of those variables later (because you assume no one changed it,
or it actually describes the value it should). This could be
inefficient, but compiler optimizers can get rid of these
inefficiencies anyway, so why make it more confusing to a potential
consumer?</p>
</div>
<div class="section" id="duplicate-observed-data">
<h3>Duplicate Observed Data</h3>
<p>This is basically pushing for a decoupling of data stored on both a
client (interface) as well as a publisher. There's a lot of times
where the client will store data that's almost identical to an object
that already exists and has all the information stored neatly. Reducing the
duplication of data is always a good thing.</p>
</div>
<div class="section" id="separate-query-from-modifier">
<h3>Separate Query from Modifier</h3>
<p>There's a lot of methods that not only perform formatting or retrieve
data, but also mutate data as well. This refactoring suggests
separating them:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
    <span class="n">log_object</span><span class="o">.</span><span class="n">access_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log_object</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
</pre></div>
<p>After:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increment_access_count</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
  <span class="n">log_object</span><span class="o">.</span><span class="n">access_count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log_object</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>

<span class="n">increment_access_count</span><span class="p">(</span><span class="n">log_object</span><span class="p">)</span>
<span class="k">return</span> <span class="n">retrieve_name</span><span class="p">(</span><span class="n">log_object</span><span class="p">)</span>
</pre></div>
<p>I can't count the number of times I wanted to have one specific part
of the function a function performs. Refactorings such as this one
really give modular pieces that can be stitched together as necessary.</p>
</div>
</div>
<div class="section" id="the-general-refactoring-principles">
<h2>The General Refactoring Principles</h2>
<p>The book's scatters some great gems about what a good refactoring
looks like, and it's very similar to what is commonly known to be good
code:</p>
<ul class="simple">
<li>mostly self-documenting: code that is so easily legible that it your
barely even need comments to understand what it's doing: intelligible
variable and function names, written like plain English more that code.</li>
<li>modular: each function is split into small, singularly functional units.</li>
<li>taking advantage of the principles and idioms for the language at
hand: 'refactoring' was written with object-oriented languages in
mind, so it advocated strong utilization of OOP. Utilize the
programming language's strengths.</li>
</ul>
<p>Any step that takes your code in that direction (whilst preserving
functionality) is a good example of a refactoring.</p>
</div>
<div class="section" id="how-to-allocate-time-to-refactor">
<h2>How to Allocate Time to Refactor</h2>
<p>'Refactoring' also stresses and appropriate time to refactor code:
constantly. Martin Fowler argues refactoring should occur during the
development process, and time should be added to estimates to give
space for refactoring. I've never been given explicit amounts of time
to refactor code, and most of the time, you won't. Best thing to do is
to push yourself to refactor whenever it's appropriate. The book also
warns against going overboard, only refactoring what you need. It's a very
agile approach to the idea of refactoring.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Ultimately, 'Refactoring' doesn't blow my mind and introduce me to
some life-changing concept. That said, it definitely changed my
mindset about refactoring. Refactoring should:</p>
<ul class="simple">
<li>be done as you go</li>
<li>move the code toward being easily comprehensible</li>
<li>move the code toward being easily extendable</li>
<li>have a strong set of testing around it to preserve functionality</li>
</ul>
<p>As I was about to tackle a fairly large refactoring, It was a great
read to organize my thoughts about my methodologies and practices, and
my goals.</p>
<p>I don't recommend reading every word, but the chapters that explain
philosophies and glancing over the refactoring patters was more that
worth the time spent reading.</p>
</div>
<p>There are <a href="./book-report-refactoring-by-martin-fowler.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://y.tsutsumi.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://github.com/toumorokoshi">GitHub</a></li>
                            <li><a href="https://twitter.com/tsutsumiyusuke">Twitter</a></li>
                            <li><a href="http://www.linkedin.com/profile/view?id=56043626">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-29270527-2', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'tsutsumi';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>