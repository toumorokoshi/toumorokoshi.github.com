<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Introducing transmute-core: quickly create documented, input validating APIs for any web framework</title>
        <link rel="stylesheet" href="./theme/css/main.css" />
        <link href="http://y.tsutsumi.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="y.tsutsumi.io Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">y.tsutsumi.io </a></h1>
                <nav><ul>
                    <li><a href="/category/programming.html">Just Programming Posts</a></li>
                    <li><a href="/codersguide/">Coder's Guide</a></li>
                    <li><a href="https://nbviewer.jupyter.org/github/toumorokoshi/notebooks/tree/master/">Notebooks</a></li>
                    <li><a href="./pages/about-me.html">About Me</a></li>
                    <li><a href="./pages/projects.html">Projects</a></li>
                    <li><a href="./pages/resources.html">Resources</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="./introducing-transmute-core-quickly-create-documented-input-validating-apis-for-any-web-framework.html" rel="bookmark"
           title="Permalink to Introducing transmute-core: quickly create documented, input validating APIs for any web framework">Introducing transmute-core: quickly create documented, input validating APIs for any web framework</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-03T00:00:00+01:00">
                Published: Tue 03 January 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="./author/yusuke-tsutsumi.html">Yusuke Tsutsumi</a>
        </address>
<p>In <a href="./category/programming.html">programming</a>.</p>
<p>tags: <a href="./tag/python.html">Python</a> </p>
</footer><!-- /.post-info -->      <p>A majority of my career has been spent on building web services in
Python. Specifically, internal ones that have minimal or no UIs, and
speak <a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> (or
at least are rest-ish).</p>
<p>With each new service, I found myself re-implementing work to
make user-friendly REST APIs:</p>
<ul class="simple">
<li>validation of incoming data, and descriptive errors when a field does not
match the type or is otherwise invalid.</li>
<li>documenting said schema, providing UIs or wiki pages allowing users to
understand what the API provides.</li>
<li>handling serialization to and from multiple content types (json, yaml)</li>
</ul>
<p>This is maddening work to do over and over again, and details are
often missed: sometimes yaml is not supported for a particular API, or
there is a specific field that is not validated. Someone will ask about
an API that you changed, and forgot to document a new parameter. It's hard to
scale API maintenance when you're dealing with forgetting some minute boilerplate.</p>
<p>This was further exacerbated by using different web frameworks for
different projects. Every framework provides their own REST plugin or
library, and often there's a lack of functional parity, or declaring
an API is completely different and requires learning multiple
approaches.</p>
<p>So with this monumental pain, what if I told you can get an API that:</p>
<ul class="simple">
<li>validates incoming data types</li>
<li>supports multiple content types</li>
<li>has a fully documented UI</li>
</ul>
<p>Just by writing a vanilla Python function? And what if I told you
this can work for YOUR Python framework of choice in 100 statements
of Python code?</p>
<p>Well, that's what the transmute framework is.</p>
<div class="section" id="how-it-works">
<h2>How it works</h2>
<p><a class="reference external" href="http://transmute-core.readthedocs.io/en/latest/">transmute-core</a> is
a library that provides tools to quickly implement rest APIs. It's
designed to be consumed indirectly, through a thin layer that adapts
it to the style of the individual framework.</p>
<div class="section" id="http-endpoints">
<h3>HTTP Endpoints</h3>
<p>Here is an example of a GET endpoint in flask:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flask_transmute</span>

<span class="c1"># flask-like decorator.</span>
<span class="nd">@flask_transmute</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">paths</span><span class="o">=</span><span class="s1">&#39;/multiply&#39;</span><span class="p">)</span>
<span class="c1"># tell transmute what types are, which ensures validations</span>
<span class="nd">@flask_transmute</span><span class="o">.</span><span class="n">annotate</span><span class="p">({</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
<span class="c1"># the function is a vanilla Python function</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">left</span> <span class="o">*</span> <span class="n">right</span>
</pre></div>
<p>And one in aiohttp, the web framework that uses Python 3's asyncio:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">aiohttp_transmute</span>

<span class="nd">@aiohttp_transmute</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">paths</span><span class="o">=</span><span class="s1">&#39;/multiply&#39;</span><span class="p">)</span>
<span class="c1"># tell transmute what types are, which ensures validations</span>
<span class="c1"># Python3.5+ supports annotations natively</span>
<span class="c1">#</span>
<span class="c1"># request is provided by aiohttp.</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">left</span> <span class="o">*</span> <span class="n">right</span>

<span class="n">aiohttp_transmute</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">multiply</span><span class="p">)</span>
</pre></div>
<p>Both do the following:</p>
<ul class="simple">
<li>generate a valid route in the target framework</li>
<li>detect the content type (yaml or json, and parse the body)</li>
<li>verify that input parameters match the parameters specified. return a 400 status
code an details if not.</li>
<li>write back yaml or json, depending on the content type</li>
</ul>
<p>Note that we don't have to deal with the content type serialization,
read from request objects, or returning a valid response object:
that's all handled by transmute. This keeps the functions cleaner in
general: it looks similar to any other Python function.</p>
</div>
<div class="section" id="complex-schemas-via-schematic-or-any-validation-framework">
<h3>Complex Schemas via Schematic (or any validation framework)</h3>
<p>Primitive types in the parameters are OK, but it's often true that
more complex types are desired.</p>
<p>Schema declaration and validation has multiple solutions
already, so transmute defers this other libraries. By default transmute uses
<a class="reference external" href="http://schematics.readthedocs.org/en/latest/">schematics</a>.:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">schematics.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">schematics.types</span> <span class="kn">import</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntType</span>

<span class="k">class</span> <span class="nc">Card</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">StringType</span><span class="p">()</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">()</span>


<span class="c1"># passing in a schematics model as the type enables</span>
<span class="c1"># validation and creation of the object when converted</span>
<span class="c1"># to an API.</span>
<span class="nd">@annotate</span><span class="p">({</span><span class="s2">&quot;card&quot;</span><span class="p">:</span> <span class="n">Card</span><span class="p">})</span>
<span class="k">def</span> <span class="nf">submit_card</span><span class="p">(</span><span class="n">card</span><span class="p">):</span>
    <span class="n">db</span><span class="o">.</span><span class="n">save_card</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
</pre></div>
<p>Of course, some may prefer other solutions like marshmallow. In that
case, transmute-core provides a transmute-context for users to customize and use
their own implementation of transmute's serializers:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">transmute_core</span> <span class="kn">import</span> <span class="n">TransmuteContext</span><span class="p">,</span> <span class="n">default_context</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">TransmuteContext</span><span class="p">(</span><span class="n">serializers</span><span class="o">=</span><span class="n">MySerializer</span><span class="p">())</span>

<span class="n">route</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

<span class="c1"># alternatively, you could modify the default context directly</span>
<span class="c1"># (be careful about where this code is called: it needs</span>
<span class="c1"># to happen before any routes are constructed)</span>
<span class="n">default_context</span><span class="o">.</span><span class="n">serializers</span> <span class="o">=</span> <span class="n">MySerializer</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="documentation-via-swagger">
<h3>Documentation via Swagger</h3>
<p><a class="reference external" href="http://swagger.io/">Swagger / OpenAPI</a> allows one to define a REST API using json. Transmute generates
swagger json files based on the transmute routes added to an app, and transmute-core provides the static CSS and JavaScript
files required to render a nice documentation interface for it:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_transmute</span> <span class="kn">import</span> <span class="n">add_swagger</span>

<span class="c1"># reads all the transmute routes that have been added, extracts their</span>
<span class="c1"># swagger definitions, and generates a swagger json and an HTML page that renders it.</span>
<span class="n">add_swagger</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">&quot;/swagger.json&quot;</span><span class="p">,</span> <span class="s2">&quot;/swagger&quot;</span><span class="p">)</span>
</pre></div>
<img alt="" src="images/transmute-core-swagger.png" />
<br/><br/><p>This also means clients can be auto-generated as well: swagger has a
large number of open source projects dedicated to parsing and
generating swagger clients. However, I haven't explored this too
deeply.</p>
</div>
</div>
<div class="section" id="lightweight-framework-implementations">
<h2>Lightweight Framework Implementations</h2>
<p>Earlier in this post, it is mentioned that there should a wrapper
around transmute-core for your framework, as the style of how to add
routes and how to extract values from requests may vary.</p>
<p>A goal of transmute was to make the framework-specific code as thin as
possible: this allows more re-use and common behavior across the
frameworks, enabling developers across frameworks to improve
functionality for everyone.</p>
<p>Two reference implementations exist, and they are very thin. As of this writing, they are at:</p>
<ul class="simple">
<li>flask-transmute: 166 lines of code, 80 statements</li>
<li>aiohttp-transmute: 218 lines of code, 103 statements (a little bloated to support legacy APIs)</li>
</ul>
<p>A one-page example for flask integration is also provided, to
illustrate what is required to create a new one. That's 200 LOC with
comments, a little more than 100 without.</p>
<p><a class="reference external" href="http://transmute-core.readthedocs.io/en/latest/creating_a_framework.html">http://transmute-core.readthedocs.io/en/latest/creating_a_framework.html</a></p>
</div>
<div class="section" id="impressions">
<h2>Impressions</h2>
<p>Frameworks are always a means to an end: it's about reducing that
effort between what you want to build and actually building it.</p>
<p>I love great, well designed APIs. And dealing with the minutiae of
some detail I missed in boilerplate content type handling or object
serialization was draining the enjoyment out of authoring them. Since
I've started using transmute for all of my projects, it's let me focus
on what I care about most: actually writing the functional code, and
designing the great interfaces that let people use them. For the most part,
it feels like just writing another function in Python.</p>
<p>The auto-documentation is freeing from both sides: as an author I can
keep my documentation in line with my implementation, because my
implementation is the source. For consumers, they're immediately
provided with a simple UI where they can rapidly iterate with the API
call they would like to make.</p>
<p>It's also great knowing I can use transmute in the next framework,
whatever that may be: I can take all the work and behavior that's
embedded in transmute, with a module or two's worth of code.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p><a class="reference external" href="http://transmute-core.readthedocs.io/en/latest/index.html">Give it a shot</a>! <a class="reference external" href="https://github.com/toumorokoshi/transmute-core">Issues
and PRs</a> are welcome, and I'd love to see someone apply transmute to
another framework.</p>
</div>

    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'tsutsumi';
        var disqus_identifier = 'introducing-transmute-core-quickly-create-documented-input-validating-apis-for-any-web-framework.html';
        var disqus_url = './introducing-transmute-core-quickly-create-documented-input-validating-apis-for-any-web-framework.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//tsutsumi.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://y.tsutsumi.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://github.com/toumorokoshi">GitHub</a></li>
                            <li><a href="https://twitter.com/tsutsumiyusuke">Twitter</a></li>
                            <li><a href="http://www.linkedin.com/profile/view?id=56043626">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-29270527-2', 'auto');
    ga('send', 'pageview');
    </script>
<script type="text/javascript">
    var disqus_shortname = 'tsutsumi';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>